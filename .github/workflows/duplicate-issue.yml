name: ğŸ” Duplicate Issue Detector

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  detect-duplicate:
    runs-on: ubuntu-latest

    steps:
      - name: Check for Duplicate Issues
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const newIssue = context.payload.issue;
            const newTitle = newIssue.title.toLowerCase();
            const newBody = (newIssue.body || '').toLowerCase();

            const { owner, repo } = context.repo;

            const issues = await github.rest.issues.listForRepo({
              owner,
              repo,
              state: 'open',
              per_page: 50
            });

            for (const issue of issues.data) {
              if (issue.number === newIssue.number) continue;

              const oldTitle = issue.title.toLowerCase();
              const oldBody = (issue.body || '').toLowerCase();

              // Simple similarity check
              if (
                oldTitle.includes(newTitle) ||
                newTitle.includes(oldTitle) ||
                (newBody && oldBody && oldBody.includes(newBody))
              ) {
                const comment = `
                ## ğŸ” Possible Duplicate Issue

                Hi @${newIssue.user.login} ğŸ‘‹,

                This issue appears to be **similar to an existing one**:

                ğŸ‘‰ **#${issue.number} â€“ ${issue.title}**

                ### âœ… What should you do?
                - If this is the same problem, please continue the discussion on the existing issue.
                - If it's different, kindly explain **how this issue is unique** so maintainers can review it.

                Keeping issues clean helps everyone contribute better and faster.  
                Thanks for your understanding! ğŸ™Œ

                ---
                `;

                await github.rest.issues.createComment({
                  owner,
                  repo,
                  issue_number: newIssue.number,
                  body: comment
                });

                break;
              }
            }